<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zapisz się przez cennik — Krav Maga Saggita</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800;900&family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}

:root{
  --bg:#0d0a0a;
  --accent:#B21900;
  --accent-rgb:178,25,0;
  --accent-glow:rgba(178,25,0,0.18);
  --accent-hot:#DA2A00;

  --blue:#1A6FD4;
  --blue-rgb:26,111,212;
  --blue-light:#5BA8FF;
  --blue-glow:rgba(26,111,212,0.18);

  --white:#FFFFFF;
  --text:rgba(255,255,255,0.88);
  --text-muted:rgba(255,255,255,0.52);
  --line:rgba(255,255,255,0.09);
  --line-soft:rgba(255,255,255,0.06);

  --glass:rgba(255,255,255,0.04);
  --glass-strong:rgba(255,255,255,0.07);
  --glass-dark:rgba(0,0,0,0.32);

  --shadow-deep:0 32px 80px rgba(0,0,0,0.7);
  --shadow-card:0 8px 32px rgba(0,0,0,0.45);

  --radius:20px;
  --radius-sm:14px;
  --radius-xs:10px;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family:'Open Sans',sans-serif;
  overflow-x:hidden;
  min-height:100vh;
}

/* Subtle background radial glows */
body::before{
  content:'';
  position:fixed;
  inset:0;
  background:
    radial-gradient(ellipse 60% 40% at 20% 10%, rgba(178,25,0,0.06) 0%, transparent 60%),
    radial-gradient(ellipse 50% 35% at 80% 80%, rgba(26,111,212,0.05) 0%, transparent 55%);
  pointer-events:none;
  z-index:0;
}

.page{
  position:relative;
  z-index:1;
  max-width:1280px;
  margin:0 auto;
  padding:56px 40px 120px;
}
@media (max-width:1024px){ .page{ padding:40px 28px 100px; } }
@media (max-width:600px){  .page{ padding:28px 16px 80px; } }

/* ═══════════════════════════════════════
   HEADER ROW — nagłówek + koszyk inline
   ═══════════════════════════════════════ */
.header-row{
  display:grid;
  grid-template-columns:1fr 280px;
  gap:32px;
  align-items:start;
  margin-bottom:32px;
}
@media (max-width:680px){ .header-row{ grid-template-columns:1fr; gap:20px; } }

.brand{display:flex;flex-direction:column;gap:8px}
.kicker{
  display:inline-flex;align-items:center;gap:9px;
  font-size:11px;font-weight:700;letter-spacing:.16em;text-transform:uppercase;
  color:rgba(255,255,255,0.50);
}
.kicker-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--accent);
  box-shadow:0 0 0 4px rgba(178,25,0,0.15), 0 0 12px rgba(178,25,0,0.4);
}
h1{
  font-family:'Montserrat',sans-serif;
  font-size:52px;font-weight:600;line-height:1.05;
  color:var(--white);letter-spacing:.04em;text-transform:uppercase;
}
.header-sub{
  font-family:'Open Sans',sans-serif;
  font-size:14px;font-weight:400;
  color:rgba(255,255,255,0.52);
  margin-top:4px;
}

/* Koszyk — mały blok inline z nagłówkiem */
.cart-inline{
  background:rgba(255,255,255,0.045);
  backdrop-filter:blur(20px) saturate(180%);
  -webkit-backdrop-filter:blur(20px) saturate(180%);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:var(--radius-sm);
  padding:18px 20px;
  width:100%;
  box-shadow:var(--shadow-card), inset 0 1px 0 rgba(255,255,255,0.08);
  display:flex;flex-direction:column;gap:12px;
}
.cart-inline__label{
  font-size:10px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;
  color:rgba(255,255,255,0.42);
}
.cart-inline__service{
  font-size:13px;font-weight:700;color:var(--white);
  min-height:18px;
}
.cart-inline__price{
  font-family:'Montserrat',sans-serif;
  font-size:26px;font-weight:900;color:var(--white);
  line-height:1;
}
.cart-inline__price small{
  font-size:13px;font-family:'Open Sans',sans-serif;font-weight:500;
  color:rgba(255,255,255,0.45);margin-left:4px;
}
.cart-inline__actions{
  display:flex;gap:8px;
}
.cart-inline__hint{
  font-size:11px;color:rgba(255,255,255,0.38);line-height:1.4;
  font-style:italic;
}
/* cart state: empty */
.cart-inline.empty .cart-inline__service{color:rgba(255,255,255,0.3);font-style:italic;font-weight:400}
.cart-inline.empty .cart-inline__price{color:rgba(255,255,255,0.18)}

/* ═══════════════════════════════════════
   STEPPER
   ═══════════════════════════════════════ */
.stepper{
  display:flex;gap:8px;flex-wrap:wrap;margin-bottom:32px;
}
.step{
  display:inline-flex;align-items:center;gap:9px;
  padding:8px 14px;
  border:1px solid var(--line);
  border-radius:999px;
  background:var(--glass);
  color:rgba(255,255,255,0.48);
  font-size:12px;font-weight:600;letter-spacing:.02em;
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
  transition:all .2s;
}
.step .n{
  width:20px;height:20px;border-radius:50%;
  display:inline-flex;align-items:center;justify-content:center;
  font-size:11px;font-weight:800;
  border:1px solid rgba(255,255,255,0.12);
  color:rgba(255,255,255,0.55);
}
.step.active{
  border-color:rgba(var(--accent-rgb),0.45);
  background:rgba(var(--accent-rgb),0.10);
  color:rgba(255,255,255,0.90);
}
.step.active .n{
  border-color:rgba(var(--accent-rgb),0.50);
  color:var(--white);background:rgba(var(--accent-rgb),0.22);
}

/* ═══════════════════════════════════════
   PANELS
   ═══════════════════════════════════════ */
.panel{
  border:1px solid rgba(255,255,255,0.09);
  background:rgba(255,255,255,0.03);
  backdrop-filter:blur(24px) saturate(160%);
  -webkit-backdrop-filter:blur(24px) saturate(160%);
  border-radius:var(--radius);
  box-shadow:var(--shadow-deep), inset 0 1px 0 rgba(255,255,255,0.06);
  overflow:hidden;
}
.panelHead{
  padding:20px 22px 16px;
  border-bottom:1px solid var(--line);
  display:flex;align-items:flex-end;justify-content:space-between;gap:14px;
}
.panelHead h2{
  font-family:'Montserrat',sans-serif;
  font-size:18px;font-weight:600;color:var(--white);letter-spacing:-.01em;
}
.panelHead p{color:var(--text-muted);font-size:13px;margin-top:5px;max-width:70ch}
.panelBody{padding:20px 22px 22px}

/* ═══════════════════════════════════════
   STEP 1 — GRID CENNIKA
   ═══════════════════════════════════════ */
.prices-layout{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:24px;
  margin-top:0;
}
@media (max-width:820px){ .prices-layout{grid-template-columns:1fr} }

/* KOLUMNA CENNIKOWA */
.price-col{
  border-radius:var(--radius-sm);
  overflow:hidden;
  display:flex;flex-direction:column;
  border:1px solid rgba(255,255,255,0.09);
  backdrop-filter:blur(16px);
  -webkit-backdrop-filter:blur(16px);
}

/* Nagłówek kolumny */
.price-col__head{
  padding:20px 22px 16px;
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  border-bottom:1px solid rgba(255,255,255,0.08);
}
.price-col__title{
  font-family:'Montserrat',sans-serif;
  font-size:22px;font-weight:600;letter-spacing:-.01em;
}
.price-col__meta{
  font-size:11px;font-weight:700;letter-spacing:.10em;text-transform:uppercase;
  padding:5px 12px;border-radius:999px;
}
.price-col__body{
  padding:18px 18px 22px;
  display:flex;flex-direction:column;gap:12px;
  flex:1;
}

/* === DOROŚLI — czerwona kolumna === */
.price-col.adults{
  background:linear-gradient(145deg, rgba(178,25,0,0.12) 0%, rgba(0,0,0,0.28) 60%);
  box-shadow:0 0 0 1px rgba(178,25,0,0.22) inset, var(--shadow-card);
}
.price-col.adults .price-col__head{
  background:rgba(178,25,0,0.14);
  border-bottom-color:rgba(178,25,0,0.25);
}
.price-col.adults .price-col__title{color:#FF6B4A}
.price-col.adults .price-col__meta{
  background:rgba(178,25,0,0.20);
  border:1px solid rgba(178,25,0,0.35);
  color:rgba(255,150,120,0.90);
}

/* === DZIECI — niebieska kolumna === */
.price-col.kids{
  background:linear-gradient(145deg, rgba(26,111,212,0.10) 0%, rgba(0,0,0,0.28) 60%);
  box-shadow:0 0 0 1px rgba(26,111,212,0.20) inset, var(--shadow-card);
}
.price-col.kids .price-col__head{
  background:rgba(26,111,212,0.12);
  border-bottom-color:rgba(26,111,212,0.22);
}
.price-col.kids .price-col__title{color:var(--blue-light)}
.price-col.kids .price-col__meta{
  background:rgba(26,111,212,0.18);
  border:1px solid rgba(26,111,212,0.32);
  color:rgba(130,190,255,0.90);
}

/* KARTY POZYCJI CENNIKA */
.priceCard{
  border-radius:var(--radius-xs);
  padding:16px 18px;
  display:flex;flex-direction:column;gap:7px;
  transition:transform .15s ease, box-shadow .15s ease;
  position:relative;
  overflow:hidden;
}
.priceCard::before{
  content:'';
  position:absolute;inset:0;
  background:rgba(255,255,255,0.025);
  opacity:0;
  transition:opacity .15s;
}
.priceCard:hover{transform:translateY(-2px)}
.priceCard:hover::before{opacity:1}

/* Karta dorosłych */
.adults .priceCard{
  background:rgba(178,25,0,0.09);
  border:1px solid rgba(178,25,0,0.22);
}
.adults .priceCard:hover{box-shadow:0 6px 24px rgba(178,25,0,0.25)}

/* Karta dzieci */
.kids .priceCard{
  background:rgba(26,111,212,0.09);
  border:1px solid rgba(26,111,212,0.20);
}
.kids .priceCard:hover{box-shadow:0 6px 24px rgba(26,111,212,0.25)}

.priceCard__top{
  display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
}
.priceCard__name{
  font-size:14px;font-weight:800;line-height:1.25;color:var(--white);
}
.priceCard__duration{
  font-size:11px;font-weight:600;color:rgba(255,255,255,0.45);
  margin-top:2px;letter-spacing:.03em;
}
.price-amount{
  font-family:'Montserrat',sans-serif;
  font-size:28px;font-weight:900;line-height:1;
  color:var(--white);
  margin-top:4px;
}
.price-amount small{
  font-size:13px;font-family:'Open Sans',sans-serif;font-weight:600;
  color:rgba(255,255,255,0.50);margin-left:3px;
}
.price-fee{
  font-size:11px;font-weight:600;line-height:1.4;
  color:rgba(255,255,255,0.40);margin-top:1px;
}
.price-desc{
  font-size:12px;line-height:1.5;
  color:rgba(255,255,255,0.50);margin-top:2px;
}

/* PRZYCISKI */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:11px 16px;border-radius:12px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.05);
  color:rgba(255,255,255,0.88);
  cursor:pointer;font-weight:700;font-size:13px;
  letter-spacing:.03em;
  transition:transform .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
  white-space:nowrap;
  font-family:'Open Sans',sans-serif;
}
.btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,0.22);background:rgba(255,255,255,0.08)}
.btn:disabled{opacity:.38;cursor:not-allowed;transform:none !important}
.btn.ghost{background:transparent;border-color:rgba(255,255,255,0.10)}
.btn.ghost:hover{background:rgba(255,255,255,0.05)}
.btnSmall{padding:8px 12px;font-size:12px;border-radius:9px}

/* Przycisk Wybierz — Dorośli */
.btn-adults{
  background:linear-gradient(135deg, rgba(178,25,0,0.80), rgba(218,42,0,0.65));
  border-color:rgba(178,25,0,0.70);
  color:#fff;
  box-shadow:0 4px 14px rgba(178,25,0,0.30);
}
.btn-adults:hover{
  background:linear-gradient(135deg, rgba(218,42,0,0.90), rgba(178,25,0,0.80));
  border-color:rgba(218,42,0,0.85);
  box-shadow:0 6px 20px rgba(178,25,0,0.45);
}

/* Przycisk Wybierz — Dzieci */
.btn-kids{
  background:linear-gradient(135deg, rgba(26,111,212,0.80), rgba(91,168,255,0.55));
  border-color:rgba(26,111,212,0.65);
  color:#fff;
  box-shadow:0 4px 14px rgba(26,111,212,0.30);
}
.btn-kids:hover{
  background:linear-gradient(135deg, rgba(26,111,212,0.95), rgba(91,168,255,0.70));
  border-color:rgba(91,168,255,0.70);
  box-shadow:0 6px 20px rgba(26,111,212,0.45);
}

/* Przycisk CTA "Przejdź do wyboru terminu" */
.btn.primary{
  background:linear-gradient(135deg, rgba(var(--accent-rgb),0.90), rgba(var(--accent-rgb),0.65));
  border-color:rgba(var(--accent-rgb),0.70);
  color:#fff;
  box-shadow:0 4px 18px rgba(var(--accent-rgb),0.30);
  padding:13px 20px;font-size:14px;font-weight:800;
}
.btn.primary:hover{
  background:linear-gradient(135deg, rgba(var(--accent-rgb),1), rgba(var(--accent-rgb),0.80));
  box-shadow:0 6px 24px rgba(var(--accent-rgb),0.50);
}

/* ═══════════════════════════════════════
   INSTRUKCJA KROKÓW
   ═══════════════════════════════════════ */
.step-hint{
  display:flex;align-items:center;gap:10px;flex-wrap:wrap;
  padding:11px 16px;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.07);
  border-radius:999px;
  margin-bottom:20px;
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
}
.step-hint__item{
  display:flex;align-items:center;gap:7px;
  font-size:12px;color:rgba(255,255,255,0.45);
  font-weight:500;
}
.step-hint__num{
  width:18px;height:18px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:10px;font-weight:800;
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.12);
  color:rgba(255,255,255,0.55);flex-shrink:0;
}
.step-hint__arrow{color:rgba(255,255,255,0.20);font-size:10px}

/* ═══════════════════════════════════════
   FORMULARZE (kroki 2-4)
   ═══════════════════════════════════════ */
.formGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.formGrid .full{grid-column:1/-1}
@media (max-width:720px){.formGrid{grid-template-columns:1fr}}
.field label{
  display:block;font-size:11px;font-weight:700;letter-spacing:.08em;
  text-transform:uppercase;color:rgba(255,255,255,0.55);margin-bottom:6px;
}
.field input,.field select,.field textarea{
  width:100%;padding:11px 13px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.04);
  backdrop-filter:blur(8px);
  color:rgba(255,255,255,0.90);
  outline:none;
  transition:border-color .15s, box-shadow .15s;
}
.field input:focus,.field select:focus,.field textarea:focus{
  border-color:rgba(var(--accent-rgb),0.55);
  box-shadow:0 0 0 5px rgba(var(--accent-rgb),0.08);
}
.field textarea{min-height:90px;resize:vertical}
.help{margin-top:6px;color:rgba(255,255,255,0.42);font-size:12px;line-height:1.4}
.inline{
  display:flex;align-items:flex-start;gap:10px;
  padding:12px 13px;border-radius:12px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(255,255,255,0.025);
}
.inline input{width:auto;margin-top:2px}
.inline label{margin:0;font-size:13px;color:rgba(255,255,255,0.80);font-weight:600;letter-spacing:0;text-transform:none}

/* ═══════════════════════════════════════
   SUMMARY, NOTICES
   ═══════════════════════════════════════ */
.notice{
  border:1px solid rgba(var(--accent-rgb),0.25);
  background:rgba(var(--accent-rgb),0.07);
  backdrop-filter:blur(8px);
  border-radius:14px;padding:12px 14px;
  color:rgba(255,255,255,0.80);font-size:13px;line-height:1.5;
}
.notice strong{color:var(--white)}
.summary{display:grid;gap:8px}
.sRow{
  display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;
  padding:10px 13px;border-radius:12px;
  border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.025);font-size:13px;
}
.sRow b{color:rgba(255,255,255,0.88)}
.sRow span{color:rgba(255,255,255,0.55)}
.footerBar{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:14px}

/* CARD (step 5) */
.card{
  border:1px solid rgba(255,255,255,0.09);
  background:rgba(255,255,255,0.03);
  border-radius:var(--radius-sm);padding:16px;
  backdrop-filter:blur(12px);
}
.cardTitle{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.cardTitle strong{color:var(--white);font-size:15px;font-weight:800}
.pill{
  display:inline-flex;align-items:center;gap:6px;
  padding:5px 10px;border-radius:999px;
  border:1px solid rgba(var(--accent-rgb),0.28);
  background:rgba(var(--accent-rgb),0.10);
  color:rgba(255,255,255,0.80);font-size:12px;font-weight:700;white-space:nowrap;
}
.small{color:rgba(255,255,255,0.50);font-size:12px;margin-top:8px;line-height:1.45}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}

/* ═══════════════════════════════════════
   TOAST
   ═══════════════════════════════════════ */
.toastWrap{
  position:fixed;left:0;right:0;bottom:16px;
  display:flex;justify-content:center;pointer-events:none;z-index:9999;
}
.toast{
  pointer-events:auto;
  max-width:min(680px,calc(100% - 24px));
  border-radius:999px;padding:12px 18px;
  border:1px solid rgba(255,255,255,0.14);
  background:rgba(12,8,8,0.88);
  backdrop-filter:blur(20px);
  color:rgba(255,255,255,0.90);
  box-shadow:0 20px 60px rgba(0,0,0,0.60);
  display:flex;align-items:center;gap:10px;font-weight:700;font-size:13px;
}
.toast.ok{border-color:rgba(46,204,113,0.35)}
.toast.err{border-color:rgba(var(--accent-rgb),0.55)}
.spin{
  width:15px;height:15px;border-radius:50%;
  border:2px solid rgba(255,255,255,0.20);
  border-top-color:rgba(255,255,255,0.75);
  animation:sp 0.8s linear infinite;display:inline-block;
}
@keyframes sp{to{transform:rotate(360deg)}}
.hidden{display:none !important}

/* mobile */
@media (max-width:600px){
  h1{font-size:36px}
  .prices-layout{gap:14px}
  .btn.primary{width:100%}
  .cart-inline__actions{flex-direction:column}
  .cart-inline__actions .btn{width:100%}
  .price-col__head{padding:16px}
  .price-col__body{padding:14px 14px 18px}
  .priceCard{padding:13px 14px}
}

/* grid2 (pozostałości innych kroków) */
.grid2{display:grid;grid-template-columns:1.15fr .85fr;gap:14px}
@media (max-width:900px){.grid2{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="page">

  <!-- HEADER ROW: nagłówek + koszyk inline -->
  <div class="header-row">
    <div class="brand">
      <div class="kicker"><span class="kicker-dot"></span><span>KRAV MAGA SAGGITA</span></div>
      <h1>Cennik</h1>
      <p class="header-sub">Sprawdź ceny, wybierz karnet i zapisz się na zajęcia.</p>
    </div>

    <!-- Koszyk inline -->
    <div class="cart-inline empty" id="cartInline">
      <div class="cart-inline__label">Wybrana usługa</div>
      <div class="cart-inline__service" id="cartServiceName">Nie wybrano jeszcze</div>
      <div class="cart-inline__price" id="cartPrice">— <small>zł</small></div>
      <div class="cart-inline__actions">
        <button class="btn btnSmall ghost" id="btnClearCart" disabled>✕ Usuń</button>
        <button class="btn btnSmall primary" id="goStep2" disabled>Wybierz termin →</button>
      </div>
      <div class="cart-inline__hint" id="cartHint">Wybierz ofertę z cennika poniżej</div>
    </div>
  </div>


  <div class="stepper" id="stepper">
    <div class="step active" data-step="1"><span class="n">1</span><span>Wybór usługi</span></div>
    <div class="step" data-step="2"><span class="n">2</span><span>Lokalizacja i termin</span></div>
    <div class="step" data-step="3"><span class="n">3</span><span>Dane i zgody</span></div>
    <div class="step" data-step="4"><span class="n">4</span><span>Podsumowanie</span></div>
    <div class="step" data-step="5"><span class="n">5</span><span>Płatność</span></div>
  </div>

  <!-- STEP 1 — dwie kolumny cennika -->
  <section id="step1">
    <div class="prices-layout">

      <!-- KOLUMNA: DOROŚLI -->
      <div class="price-col adults">
        <div class="price-col__head">
          <div class="price-col__title">Dorośli</div>
          <div class="price-col__meta" id="metaAdults">—</div>
        </div>
        <div class="price-col__body" id="pricesAdultsList">
          <div style="padding:20px;text-align:center;color:rgba(255,255,255,0.35);font-size:13px"><span class="spin" style="display:inline-block;margin-right:8px"></span>Ładuję…</div>
        </div>
      </div>

      <!-- KOLUMNA: DZIECI -->
      <div class="price-col kids">
        <div class="price-col__head">
          <div class="price-col__title">Dzieci</div>
          <div class="price-col__meta" id="metaKids">—</div>
        </div>
        <div class="price-col__body" id="pricesKidsList">
          <div style="padding:20px;text-align:center;color:rgba(255,255,255,0.35);font-size:13px"><span class="spin" style="display:inline-block;margin-right:8px"></span>Ładuję…</div>
        </div>
      </div>

    </div>
  </section>

  <!-- STEP 2 -->
  <section class="panel hidden" id="step2" style="margin-top:14px">
    <div class="panelHead">
      <div>
        <h2>2) Lokalizacja, grupa i termin</h2>
        <p>Wybierz miejsce treningów i konkretny termin z grafiku. Pokażemy tylko dostępne opcje.</p>
      </div>
      <button class="btn btnSmall ghost" id="back1">Wstecz</button>
    </div>
    <div class="panelBody">
      <div class="formGrid">
        <div class="field full">
          <label>Lokalizacja *</label>
          <select id="f_location"><option value="">Ładowanie…</option></select>
          <div class="help">Najpierw wybierz lokalizację – wtedy pokażemy dostępne grupy.</div>
        </div>
        <div class="field full">
          <label>Grupa *</label>
          <select id="f_group"><option value="">Najpierw wybierz lokalizację</option></select>
          <div class="help" id="groupHelp">—</div>
        </div>
        <div class="field full">
          <label>Termin z grafiku (opcjonalnie)</label>
          <select id="f_schedule"><option value="">— wybierz termin (opcjonalnie) —</option></select>
          <div class="help">Jeśli nie wybierzesz terminu, odezwiemy się, żeby go doprecyzować.</div>
        </div>
        <div class="field full">
          <label>Preferowana data startu (opcjonalnie)</label>
          <input id="f_start_date" type="date">
        </div>
        <div class="field full">
          <label>Preferowana godzina (opcjonalnie)</label>
          <input id="f_preferred_time" type="text" placeholder="np. poniedziałek po 18:00 / dowolnie">
        </div>
      </div>

      <div class="footerBar">
        <button class="btn" id="goStep3" disabled>Dalej: dane</button>
      </div>
    </div>
  </section>

  <!-- STEP 3 -->
  <section class="panel hidden" id="step3" style="margin-top:14px">
    <div class="panelHead">
      <div>
        <h2>3) Dane kursanta i zgody</h2>
        <p>Uzupełnij dane. Pola oznaczone * są wymagane.</p>
      </div>
      <button class="btn btnSmall ghost" id="back2">Wstecz</button>
    </div>
    <div class="panelBody">
      <div class="formGrid">
        <div class="field">
          <label>Imię *</label>
          <input id="f_first_name" type="text" placeholder="np. Jan">
        </div>
        <div class="field">
          <label>Nazwisko *</label>
          <input id="f_last_name" type="text" placeholder="np. Kowalski">
        </div>
        <div class="field">
          <label>Email *</label>
          <input id="f_email" type="email" placeholder="np. jan@email.pl">
        </div>
        <div class="field">
          <label>Telefon *</label>
          <input id="f_phone" type="text" placeholder="np. 600 000 000">
        </div>
        <div class="field">
          <label>Rok urodzenia</label>
          <input id="f_birth_year" type="number" placeholder="np. 1992">
        </div>
        <div class="field">
          <label>Typ kursanta</label>
          <select id="f_is_new">
            <option value="true">Nowy</option>
            <option value="false">Kontynuacja</option>
          </select>
          <div class="help">Dla nowych może doliczyć się jednorazowa opłata wpisowa (zgodnie z cennikiem).</div>
        </div>

        <div class="field full">
          <div class="inline">
            <input type="checkbox" id="f_has_membership" name="has_membership">
            <div>
              <label for="f_has_membership" style="font-weight:700;color:rgba(255,255,255,0.92);cursor:pointer">
                Mam już karnet miesięczny (wtedy płatność może wynosić 0 zł)
              </label>
              <div class="help">Jeśli zaznaczysz, system ustawi kwotę na 0 zł.</div>
            </div>
          </div>
        </div>

        <div class="field full">
          <div class="inline">
            <input type="checkbox" id="f_consent_data">
            <div>
              <label for="f_consent_data" style="font-weight:700;color:rgba(255,255,255,0.92);cursor:pointer">
                Wyrażam zgodę na przetwarzanie danych w celu realizacji zapisu *
              </label>
              <div class="help">Bez tej zgody nie możemy przyjąć zgłoszenia.</div>
            </div>
          </div>
        </div>

        <div class="field full">
          <div class="inline">
            <input type="checkbox" id="f_consent_rules">
            <div>
              <label for="f_consent_rules" style="font-weight:700;color:rgba(255,255,255,0.92);cursor:pointer">
                Akceptuję regulamin i zasady uczestnictwa *
              </label>
              <div class="help">To standardowe potwierdzenie, żeby wszystko było jasne od początku.</div>
            </div>
          </div>
        </div>

        <div class="field full">
          <label>Uwagi (opcjonalnie)</label>
          <textarea id="f_notes" placeholder="Np. kontuzje, preferencje, dodatkowe pytania…"></textarea>
        </div>
      </div>

      <div class="footerBar">
        <button class="btn" id="goStep4" disabled>Dalej: podsumowanie</button>
      </div>
    </div>
  </section>

  <!-- STEP 4 -->
  <section class="panel hidden" id="step4" style="margin-top:14px">
    <div class="panelHead">
      <div>
        <h2>4) Podsumowanie i potwierdzenie</h2>
        <p>Sprawdź dane i wyślij zgłoszenie. Potem pokażemy opcje płatności.</p>
      </div>
      <button class="btn btnSmall ghost" id="back3">Wstecz</button>
    </div>
    <div class="panelBody">
      <div class="summary" id="summaryBox"></div>

      <div class="notice" style="margin-top:12px">
        <strong>Uwaga:</strong> jeśli grupa jest pełna, zapis trafi na listę rezerwową – dostaniesz informację mailem.
      </div>

      <div class="footerBar">
        <button class="btn primary" id="submitBtn">Wyślij zgłoszenie</button>
      </div>
    </div>
  </section>

  <!-- STEP 5 -->
  <section class="panel hidden" id="step5" style="margin-top:14px">
    <div class="panelHead">
      <div>
        <h2>5) Płatność</h2>
        <p>Możesz przejść do płatności online albo pobrać dokument do przelewu.</p>
      </div>
      <button class="btn btnSmall ghost" id="back4">Wstecz</button>
    </div>
    <div class="panelBody">
      <div class="card">
        <div class="cardTitle">
          <strong>Twoje zgłoszenie zostało przyjęte</strong>
          <span class="pill" id="payPill">—</span>
        </div>
        <div class="small" id="payText">—</div>

        <div class="row" style="margin-top:14px">
          <button class="btn primary" id="payOnlineBtn">Płatność online</button>
          <button class="btn" id="docBtn">Pobierz dokument płatniczy</button>
        </div>

        <div class="help" id="payHelp" style="margin-top:10px">—</div>
      </div>
    </div>
  </section>

</div>

<div class="toastWrap" id="toastWrap" style="display:none">
  <div class="toast" id="toast">
    <span id="toastIcon">•</span>
    <span id="toastMsg">—</span>
  </div>
</div>

<script>
const API_BASE = 'https://saggita-kravmaga.vercel.app';
const API = `${API_BASE}/api`;

const SCHEDULE_URL = `${API}/schedule`;
const PRICES_URL = `${API}/prices`;

let scheduleData = [];
let pricesData = [];
let selectedPlan = null;

let selected = {
  location_id: null,
  group_id: null,
  schedule_id: null,
};

let registrationResult = null; // { payment_ref, total_amount, is_waitlist, ... }

function toast(msg, type='ok', ms=3200){
  const w=document.getElementById('toastWrap');
  const t=document.getElementById('toast');
  const icon=document.getElementById('toastIcon');
  const m=document.getElementById('toastMsg');
  t.className = `toast ${type==='err'?'err':'ok'}`;
  icon.textContent = type==='err' ? '!' : '✓';
  m.textContent = msg;
  w.style.display='flex';
  clearTimeout(window.__toastT);
  window.__toastT=setTimeout(()=>{ w.style.display='none'; }, ms);
}

async function fetchJson(url){
  const r = await fetch(url, { cache: 'no-store' });
  const d = await r.json().catch(()=>({error:'Błąd odpowiedzi serwera'}));
  if(!r.ok) throw new Error(d.error || `Błąd HTTP ${r.status}`);
  return d;
}

function money(v){
  const n = Number(v||0);
  return n.toLocaleString('pl-PL', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
}

function setStep(n){
  document.querySelectorAll('[id^="step"]').forEach(s=>{
    const sn = parseInt(s.id.replace('step',''),10);
    s.classList.toggle('hidden', sn!==n);
  });
  document.querySelectorAll('#stepper .step').forEach(el=>{
    el.classList.toggle('active', parseInt(el.dataset.step,10)===n);
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function planLabel(p){
  const months = p.months ? `${p.months} mies.` : 'jednorazowo';
  return `${p.name} • ${money(p.price)} zł • ${months}`;
}

function groupLabel(g){
  const cap = (typeof g.available==='number') ? `Dostępne: ${g.available}` : '';
  return `${g.name}${cap?` · ${cap}`:''}`;
}
function scheduleLabel(s){
  const day = (s.day_name!=null ? s.day_name : s.day_of_week);
  const ts = s.time_start ? String(s.time_start).slice(0,5) : '';
  const te = s.time_end ? String(s.time_end).slice(0,5) : '';
  const tl = (ts && te) ? `${ts}–${te}` : (s.time_label || ts || '');
  const addr = s.address ? ` · ${s.address}` : '';
  return `${day} ${tl}${addr}`;
}

function buildPrices(){
  const rows = Array.isArray(pricesData) ? pricesData : (Array.isArray(pricesData?.rows) ? pricesData.rows : []);

  const norm = (v)=>String(v||'').trim().toLowerCase();
  const isKids = (p)=>{ const c=norm(p.category); return c.includes('kid')||c.includes('dziec'); };
  const isAdults = (p)=>{ const c=norm(p.category); return c.includes('adult')||c.includes('doro'); };

  const adults=[], kids=[], other=[];
  rows.forEach(p=>{ if(isKids(p)) kids.push(p); else if(isAdults(p)) adults.push(p); else other.push(p); });
  other.forEach(p=>adults.push(p));
  adults.sort((a,b)=>Number(a.price||0)-Number(b.price||0));
  kids.sort((a,b)=>Number(a.price||0)-Number(b.price||0));

  document.getElementById('metaAdults').textContent = adults.length ? `${adults.length} pozycji` : 'Brak';
  document.getElementById('metaKids').textContent = kids.length ? `${kids.length} pozycji` : 'Brak';

  const renderCards = (arr, type)=>arr.map(p=>{
    const months = p.months ? `${p.months} mies.` : 'jednorazowo';
    const fee = Number(p.signup_fee||0)>0 ? `+ wpisowe ${money(p.signup_fee)} zł dla nowych` : '';
    const desc = (p.description||'').trim();
    const btnClass = type==='kids' ? 'btn-kids' : 'btn-adults';
    return `
      <div class="priceCard" id="pc-${p.id}">
        <div class="priceCard__top">
          <div>
            <div class="priceCard__name">${escapeHtml(p.name)}</div>
            <div class="priceCard__duration">${months}</div>
          </div>
          <button class="btn btnSmall ${btnClass}" onclick="selectPlan(${p.id})">Wybierz</button>
        </div>
        <div class="price-amount">${money(p.price)}<small>zł</small></div>
        ${fee ? `<div class="price-fee">${escapeHtml(fee)}</div>` : ''}
        ${desc ? `<div class="price-desc">${escapeHtml(desc)}</div>` : ''}
      </div>
    `;
  }).join('');

  document.getElementById('pricesAdultsList').innerHTML = adults.length
    ? renderCards(adults,'adults')
    : `<div style="padding:16px;color:rgba(255,255,255,0.35);font-size:13px">Brak pozycji.</div>`;
  document.getElementById('pricesKidsList').innerHTML = kids.length
    ? renderCards(kids,'kids')
    : `<div style="padding:16px;color:rgba(255,255,255,0.35);font-size:13px">Brak pozycji.</div>`;
}


function selectPlan(id){
  const p = (pricesData||[]).find(x=>Number(x.id)===Number(id));
  if(!p){ toast('Nie znaleziono pozycji z cennika','err'); return; }
  selectedPlan = p;

  // Aktualizuj koszyk inline
  const cart = document.getElementById('cartInline');
  cart.classList.remove('empty');
  document.getElementById('cartServiceName').textContent = p.name;
  document.getElementById('cartPrice').innerHTML = `${money(p.price)}<small> zł</small>`;
  document.getElementById('cartHint').textContent = p.months
    ? `Karnet ${p.months} mies. — wybierz lokalizację i termin`
    : 'Jednorazowo — wybierz lokalizację i termin';

  // Podświetl wybraną kartę
  document.querySelectorAll('.priceCard').forEach(el=>{
    el.style.outline = el.id===`pc-${id}` ? '2px solid rgba(255,255,255,0.35)' : '';
    el.style.boxShadow = '';
  });

  document.getElementById('goStep2').disabled = false;
  document.getElementById('btnClearCart').disabled = false;
  toast(`Wybrano: ${p.name}`);
}


function clearCart(){
  selectedPlan = null;
  selected = { location_id:null, group_id:null, schedule_id:null };
  registrationResult = null;

  const cart = document.getElementById('cartInline');
  cart.classList.add('empty');
  document.getElementById('cartServiceName').textContent = 'Nie wybrano jeszcze';
  document.getElementById('cartPrice').innerHTML = '— <small>zł</small>';
  document.getElementById('cartHint').textContent = 'Wybierz ofertę z cennika poniżej';

  document.getElementById('goStep2').disabled = true;
  document.getElementById('btnClearCart').disabled = true;
  document.querySelectorAll('.priceCard').forEach(el=>{ el.style.outline=''; el.style.boxShadow=''; });
  toast('Koszyk opróżniony');
}

function toggleCat(which){ /* deprecated — kolumny zawsze widoczne */ }


function escapeHtml(str){
  return String(str||'')
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}

function buildLocationSelect(){
  const sel=document.getElementById('f_location');
  sel.innerHTML = `<option value="">— wybierz lokalizację —</option>` + scheduleData.map(loc=>
    `<option value="${loc.id}">${escapeHtml(loc.city)} — ${escapeHtml(loc.name||'')}</option>`
  ).join('');
}

function rebuildGroups(){
  const locId = Number(document.getElementById('f_location').value||0);
  selected.location_id = locId || null;
  selected.group_id = null;
  selected.schedule_id = null;

  const grpSel=document.getElementById('f_group');
  const schSel=document.getElementById('f_schedule');
  const gh=document.getElementById('groupHelp');

  if(!locId){
    grpSel.innerHTML = `<option value="">Najpierw wybierz lokalizację</option>`;
    schSel.innerHTML = `<option value="">— wybierz termin (opcjonalnie) —</option>`;
    gh.textContent='—';
    validateStep2();
    return;
  }

  const loc = scheduleData.find(l=>Number(l.id)===locId);
  const groups = (loc?.groups || []).filter(g=>g.active!==false);

  if(!groups.length){
    grpSel.innerHTML = `<option value="">Brak grup w tej lokalizacji</option>`;
    schSel.innerHTML = `<option value="">—</option>`;
    gh.textContent='Brak dostępnych grup dla wybranej lokalizacji.';
    validateStep2();
    return;
  }

  grpSel.innerHTML = `<option value="">— wybierz grupę —</option>` + groups.map(g=>
    `<option value="${g.id}">${escapeHtml(groupLabel(g))}</option>`
  ).join('');

  gh.textContent = 'Wybierz grupę — pokażemy terminy z grafiku.';
  schSel.innerHTML = `<option value="">— wybierz termin (opcjonalnie) —</option>`;
  validateStep2();
}

function rebuildSchedules(){
  const locId = Number(document.getElementById('f_location').value||0);
  const gid = Number(document.getElementById('f_group').value||0);
  selected.group_id = gid || null;
  selected.schedule_id = null;

  const schSel=document.getElementById('f_schedule');
  const gh=document.getElementById('groupHelp');

  if(!locId || !gid){
    schSel.innerHTML = `<option value="">— wybierz termin (opcjonalnie) —</option>`;
    gh.textContent = !locId ? 'Najpierw wybierz lokalizację.' : 'Wybierz grupę — pokażemy terminy.';
    validateStep2();
    return;
  }

  const loc = scheduleData.find(l=>Number(l.id)===locId);
  const g = (loc?.groups || []).find(x=>Number(x.id)===gid);

  const scheds = (g?.schedules || []);
  schSel.innerHTML = `<option value="">— wybierz termin (opcjonalnie) —</option>` + scheds.map(s=>
    `<option value="${s.id}">${escapeHtml(scheduleLabel(s))}</option>`
  ).join('');

  const available = (typeof g?.available==='number') ? g.available : null;
  if(available===0){
    gh.textContent = 'Ta grupa jest aktualnie pełna — zapis może trafić na listę rezerwową.';
  }else if(available!=null){
    gh.textContent = `Dostępne miejsca: ${available}.`;
  }else{
    gh.textContent = '—';
  }

  validateStep2();
}

function validateStep2(){
  const ok = !!(selected.location_id && selected.group_id);
  document.getElementById('goStep3').disabled = !ok;
}

function validateStep3(){
  const fn = document.getElementById('f_first_name').value.trim();
  const ln = document.getElementById('f_last_name').value.trim();
  const em = document.getElementById('f_email').value.trim();
  const ph = document.getElementById('f_phone').value.trim();
  const cd = document.getElementById('f_consent_data').checked;
  const cr = document.getElementById('f_consent_rules').checked;
  const ok = fn && ln && em && ph && cd && cr;
  document.getElementById('goStep4').disabled = !ok;
}

function buildSummary(){
  const locId = selected.location_id;
  const gid = selected.group_id;
  const sid = Number(document.getElementById('f_schedule').value||0) || null;

  const loc = scheduleData.find(l=>Number(l.id)===locId);
  const g = (loc?.groups||[]).find(x=>Number(x.id)===gid);
  const s = sid ? (g?.schedules||[]).find(x=>Number(x.id)===sid) : null;

  const hasMembership = document.getElementById('f_has_membership').checked;

  const sum = document.getElementById('summaryBox');
  sum.innerHTML = `
    <div class="sRow"><b>Usługa</b><span>${escapeHtml(selectedPlan?.name || '—')}</span></div>
    <div class="sRow"><b>Cena z cennika</b><span>${hasMembership ? '0 zł (posiadacz karnetu)' : `${money(selectedPlan?.price||0)} zł`}</span></div>
    <div class="sRow"><b>Lokalizacja</b><span>${escapeHtml(loc ? `${loc.city} — ${loc.name||''}` : '—')}</span></div>
    <div class="sRow"><b>Grupa</b><span>${escapeHtml(g ? g.name : '—')}</span></div>
    <div class="sRow"><b>Termin</b><span>${escapeHtml(s ? scheduleLabel(s) : 'do ustalenia')}</span></div>
    <div class="sRow"><b>Kursant</b><span>${escapeHtml(document.getElementById('f_first_name').value.trim() + ' ' + document.getElementById('f_last_name').value.trim())}</span></div>
    <div class="sRow"><b>Kontakt</b><span>${escapeHtml(document.getElementById('f_email').value.trim())} · ${escapeHtml(document.getElementById('f_phone').value.trim())}</span></div>
  `;

  selected.schedule_id = sid;
}

async function submit(){
  if(!selectedPlan){ toast('Wybierz usługę z cennika','err'); return; }
  if(!selected.location_id || !selected.group_id){ toast('Wybierz lokalizację i grupę','err'); return; }

  const body = {
    first_name: document.getElementById('f_first_name').value.trim(),
    last_name: document.getElementById('f_last_name').value.trim(),
    email: document.getElementById('f_email').value.trim(),
    phone: document.getElementById('f_phone').value.trim(),
    birth_year: Number(document.getElementById('f_birth_year').value||0) || null,
    is_new: document.getElementById('f_is_new').value === 'true',
    group_id: selected.group_id,
    schedule_id: selected.schedule_id || null,
    price_plan_id: selectedPlan.id,
    start_date: document.getElementById('f_start_date').value || null,
    preferred_time: document.getElementById('f_preferred_time').value.trim() || null,
    consent_data: !!document.getElementById('f_consent_data').checked,
    consent_rules: !!document.getElementById('f_consent_rules').checked,
    has_membership: !!document.getElementById('f_has_membership').checked,
    notes: document.getElementById('f_notes').value || null,
  };

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = `<span class="spin"></span> Wysyłam…`;

  try{
    const d = await fetch(`${API}/register`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    }).then(async r=>{
      const j = await r.json().catch(()=>({error:'Błąd odpowiedzi serwera'}));
      if(!r.ok) throw new Error(j.error || `Błąd HTTP ${r.status}`);
      return j;
    });

    registrationResult = d;

    toast('Zgłoszenie przyjęte');
    preparePaymentUI();
    setStep(5);

  }catch(e){
    toast(e.message || 'Błąd zapisu','err', 4200);
  }finally{
    btn.disabled = false;
    btn.textContent = 'Wyślij zgłoszenie';
  }
}

function preparePaymentUI(){
  const pill=document.getElementById('payPill');
  const text=document.getElementById('payText');
  const help=document.getElementById('payHelp');
  const payBtn=document.getElementById('payOnlineBtn');
  const docBtn=document.getElementById('docBtn');

  const amount = Number(registrationResult?.total_amount||0);
  const ref = registrationResult?.payment_ref;

  if(amount<=0){
    pill.textContent = 'Brak płatności';
    text.innerHTML = `Kwota do zapłaty: <strong>0 zł</strong>. Jeśli coś trzeba doprecyzować, odezwiemy się mailowo.`;
    payBtn.disabled = true;
    docBtn.disabled = true;
    help.textContent = `Ref: ${ref || '—'}`;
    return;
  }

  pill.textContent = `${money(amount)} zł`;
  text.innerHTML = `Kwota do zapłaty: <strong>${money(amount)} zł</strong> · Ref: <strong style="font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace">${ref}</strong>`;
  help.textContent = 'Możesz opłacić online albo pobrać dokument do przelewu.';

  payBtn.disabled = false;
  docBtn.disabled = false;

  payBtn.onclick = ()=>handlePayOnline(ref);
  docBtn.onclick = ()=>downloadPaymentDoc(ref);
}

async function handlePayOnline(payment_ref){
  if(!payment_ref) return toast('Brak referencji płatności','err');

  const btn = document.getElementById('payOnlineBtn');
  const prev = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = `<span class="spin"></span> Przekierowuję…`;

  try{
    const d = await fetch(`${API}/registration/action`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ payment_ref, action: 'pay_online' })
    }).then(async r=>{
      const j = await r.json().catch(()=>({error:'Błąd odpowiedzi serwera'}));
      if(!r.ok) throw new Error(j.error || `Błąd HTTP ${r.status}`);
      return j;
    });

    // d.url expected
    if(d?.url){
      window.location.href = d.url;
    }else{
      toast('Brak linku do płatności (sprawdź konfigurację)','err', 4200);
    }
  }catch(e){
    toast(e.message || 'Błąd płatności','err', 4200);
  }finally{
    btn.disabled = false;
    btn.innerHTML = prev;
  }
}

async function downloadPaymentDoc(payment_ref){
  if(!payment_ref) return toast('Brak referencji płatności','err');
  const url = `${API}/payment-document?payment_ref=${encodeURIComponent(payment_ref)}`;
  window.open(url, '_blank');
}

async function loadAll(){
  document.getElementById('metaAdults').textContent = '…';
  document.getElementById('metaKids').textContent = '…';
  document.getElementById('pricesAdultsList').innerHTML = `<div style="padding:20px;text-align:center;color:rgba(255,255,255,0.35);font-size:13px"><span class="spin" style="display:inline-block;margin-right:8px"></span>Ładuję cennik…</div>`;
  document.getElementById('pricesKidsList').innerHTML = `<div style="padding:20px;text-align:center;color:rgba(255,255,255,0.35);font-size:13px"><span class="spin" style="display:inline-block;margin-right:8px"></span>Ładuję cennik…</div>`;
  try{
    const [sched, prices] = await Promise.all([fetchJson(SCHEDULE_URL), fetchJson(PRICES_URL)]);
    scheduleData = Array.isArray(sched) ? sched : [];
    pricesData = Array.isArray(prices) ? prices : (Array.isArray(prices?.rows)?prices.rows:[]);
    buildPrices();
    buildLocationSelect();
    toast('Dane wczytane');
  }catch(e){
    const msg = `<div style="padding:16px;color:rgba(255,100,80,0.85);font-size:13px"><strong>Błąd:</strong> ${escapeHtml(e.message||e)}</div>`;
    document.getElementById('pricesAdultsList').innerHTML = msg;
    document.getElementById('pricesKidsList').innerHTML = msg;
    document.getElementById('metaAdults').textContent = 'Błąd';
    document.getElementById('metaKids').textContent = 'Błąd';
    toast('Nie udało się wczytać danych','err', 4200);
  }
}

document.getElementById('btnClearCart').addEventListener('click', clearCart);

document.getElementById('goStep2').addEventListener('click', ()=>setStep(2));
document.getElementById('back1').addEventListener('click', ()=>setStep(1));
document.getElementById('back2').addEventListener('click', ()=>setStep(2));
document.getElementById('back3').addEventListener('click', ()=>setStep(3));
document.getElementById('back4').addEventListener('click', ()=>setStep(4));

document.getElementById('f_location').addEventListener('change', rebuildGroups);
document.getElementById('f_group').addEventListener('change', rebuildSchedules);
document.getElementById('f_schedule').addEventListener('change', ()=>{
  selected.schedule_id = Number(document.getElementById('f_schedule').value||0) || null;
});

document.getElementById('goStep3').addEventListener('click', ()=>setStep(3));
document.getElementById('goStep4').addEventListener('click', ()=>{
  buildSummary();
  setStep(4);
});

['f_first_name','f_last_name','f_email','f_phone','f_consent_data','f_consent_rules'].forEach(id=>{
  document.getElementById(id).addEventListener('input', validateStep3);
  document.getElementById(id).addEventListener('change', validateStep3);
});
document.getElementById('f_has_membership').addEventListener('change', ()=>{
  // tylko UX — płatność i kwota finalna ustawiają się po rejestracji
});
document.getElementById('submitBtn').addEventListener('click', submit);

(function boot(){
  loadAll();
  // walidacje startowe
  validateStep2();
  validateStep3();
})();
</script>
</body>
</html>
