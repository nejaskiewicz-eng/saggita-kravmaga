<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Logowanie — Panel admina</title>
  <style>
    body{margin:0;background:#0b0b0b;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:min(420px,100%);background:#141414;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:22px}
    h1{margin:0 0 12px;font-size:22px}
    label{display:block;margin:12px 0 6px;font-size:13px;opacity:.85}
    input{width:100%;padding:12px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0f0f0f;color:#fff}
    button{margin-top:14px;width:100%;padding:12px;border-radius:10px;border:0;background:#e11d48;color:#fff;font-weight:700;cursor:pointer}
    .msg{margin-top:12px;font-size:13px;opacity:.9}
    a{color:#fff}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Logowanie do panelu</h1>

      <form id="f">
        <label>Login</label>
        <input id="u" autocomplete="username" />

        <label>Hasło</label>
        <input id="p" type="password" autocomplete="current-password" />

        <button type="submit">Zaloguj</button>
      </form>

      <div class="msg" id="m"></div>
      <div class="msg" style="opacity:.7;margin-top:10px">
        Po zalogowaniu zostaniesz przeniesiona do <a href="/admin">/admin</a>.
      </div>
    </div>
  </div>

<script>
  const f = document.getElementById('f');
  const m = document.getElementById('m');

  f.addEventListener('submit', async (e) => {
    e.preventDefault();
    m.textContent = 'Loguję...';

    const username = document.getElementById('u').value.trim();
    const password = document.getElementById('p').value;

    try{
      const r = await fetch('/api/admin-api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await r.json().catch(()=>({}));
      if(!r.ok){
        m.textContent = data.error || 'Błąd logowania.';
        return;
      }

      localStorage.setItem('km_admin_token', data.token);
      m.textContent = 'OK. Przenoszę do panelu...';
      location.href = '/admin';
    }catch(err){
      m.textContent = 'Błąd połączenia.';
    }
  });
</script>
</body>
</html>
